<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SY-ON | Synapse On</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --indigo: #1A1A2E; --amber: #FFD369; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--indigo); color: var(--amber); font-family: 'Pretendard', sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; overflow-x: hidden; }
        #app { width: 100%; max-width: 450px; padding: 30px; text-align: center; position: relative; }
        
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .ghost-send { animation: ghostMove 1.5s forwards ease-in; pointer-events: none; }
        @keyframes ghostMove { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-250px) blur(15px) scale(0.6); } }

        .master-formula { font-size: 1rem; opacity: 0.8; margin: 30px 0; min-height: 50px; }
        .progress-bar { position: fixed; top: 0; left: 0; height: 3px; background: var(--amber); transition: width 0.4s; z-index: 1000; }
        
        .btn-option { width: 100%; padding: 22px; margin-bottom: 15px; background: rgba(255, 255, 255, 0.04); border: 1px solid rgba(255, 211, 105, 0.1); border-radius: 14px; color: var(--amber); text-align: left; font-size: 14px; cursor: pointer; transition: 0.3s; position: relative; }
        .btn-option.selected { background: rgba(255, 211, 105, 0.2); border-color: var(--amber); }
        .btn-main { width: 100%; padding: 20px; background: transparent; border: 1px solid var(--amber); color: var(--amber); font-size: 13px; letter-spacing: 2px; cursor: pointer; margin-top: 25px; transition: 0.3s; }
        .btn-main:active { background: var(--amber); color: var(--indigo); }
        
        .report-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 211, 105, 0.1); padding: 35px; border-radius: 20px; margin-top: 20px; }
        .tag { display: inline-block; padding: 8px 14px; margin: 5px; font-size: 11px; border: 1px solid rgba(255, 211, 105, 0.2); background: rgba(255,255,255,0.02); }
        .back-link { font-size: 11px; opacity: 0.4; text-decoration: underline; cursor: pointer; margin-top: 30px; display: inline-block; }
        .s-button { position: fixed; bottom: 25px; right: 25px; width: 44px; height: 44px; border: 1px solid rgba(255, 211, 105, 0.4); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; cursor: pointer; z-index: 1000; }
        .overlay { position: fixed; inset: 0; background: var(--indigo); z-index: 2000; display: none; flex-direction: column; padding: 40px; overflow-y: auto; text-align: left; }
    </style>
</head>
<body>
    <div id="progress" class="progress-bar" style="width: 0%"></div>
    <div id="app"></div>
    <div id="overlay" class="overlay"></div>
    <div class="s-button" onclick="showScience()">S</div>

    <script>
        /* [의장님의 지적 재산권 데이터 30문항 완전 보존] [cite: 2026-01-17] */
        const questions = [
            { id: 1, cat: "E_env", q: "낯선 곳에서 당신의 마음이 가장 먼저 머무는 온도는 어느 쪽인가요?", opts: ["정신이 맑아지는 시원하고 쾌적한 공기", "긴장이 사르르 녹는 포근하고 따뜻한 온기"] },
            { id: 2, cat: "E_env", q: "어스름한 저녁, 당신을 가장 안심시키는 빛은 어떤 모습인가요?", opts: ["주변을 선명하게 비추는 투명한 빛", "그늘진 곳을 부드럽게 감싸는 은은한 조명"] },
            { id: 3, cat: "E_env", q: "공간을 채우는 소리에 대해 당신의 마음은 어떻게 반응하나요?", opts: ["작은 소음도 하나의 신호처럼 선명하게 들린다", "주변의 소리들을 풍경처럼 자연스럽게 흘려보낸다"] },
            { id: 6, cat: "E_env", q: "창문에 맺힌 빗방울을 볼 때, 당신은 무엇에 더 집중하게 되나요?", opts: ["방울방울 맺힌 물방울의 세밀한 모양", "창 너머로 번지는 흐릿하고 정적인 풍경"] },
            { id: 9, cat: "E_env", q: "지친 마음을 달래기 위해 당신이 찾는 향기는 어떤 느낌인가요?", opts: ["머릿속을 정돈해 주는 싱그럽고 깨끗한 향", "마음을 편안하게 가라앉혀 주는 묵직한 흙내음"] },
            { id: 10, cat: "E_env", q: "가구의 모서리나 물건의 배치에 대해 당신은 얼마나 민감한 편인가요?", opts: ["모든 것이 제자리에 있을 때 깊은 안도를 느낀다", "조금 흐트러져 있어도 그 나름의 자연스러움을 즐긴다"] },
            { id: 15, cat: "E_env", q: "몸에 닿는 옷감의 감촉이 당신의 기분에 얼마나 영향을 주나요?", opts: ["까슬하거나 부드러운 감촉이 하루의 컨디션을 결정한다", "감촉보다는 옷이 주는 전체적인 분위기에 집중한다"] },
            { id: 19, cat: "E_env", q: "좁고 아늑한 다락방과 넓고 탁 트인 광장 중, 지금 당신이 숨 쉬고 싶은 곳은?", opts: ["나를 안전하게 감싸주는 작고 밀폐된 공간", "막힘없이 시야가 확보되는 시원한 공간"] },
            { id: 4, cat: "P_time", q: "누구에게도 방해받지 않는 당신만의 시간, 가장 선호하는 휴식의 깊이는?", opts: ["아무 생각 없이 감각을 잠재우는 완전한 정적", "좋아하는 것에 몰입하며 에너지를 채우는 활동"] },
            { id: 5, cat: "P_time", q: "오후 5시 15분, 오늘 하루가 유독 길었다면 당신이 가장 먼저 찾는 것은?", opts: ["말수를 줄이고 혼자만의 고요에 침잠하기", "가벼운 대화나 산책으로 분위기를 환기하기"] },
            { id: 7, cat: "P_time", q: "대화 중 찾아온 짧은 정적을 마주할 때, 당신의 마음은 어떠한가요?", opts: ["그 고요함 속에서 상대의 숨결을 느끼며 기다린다", "어색함을 채우기 위해 다정한 말을 먼저 건넨다"] },
            { id: 8, cat: "P_time", q: "서운한 마음이 들었을 때, 당신의 감정은 어떤 속도로 흐르나요?", opts: ["혼자만의 시간을 가지며 천천히 갈무리한다", "상대와 마주 앉아 그 자리에서 마음을 나누고 싶다"] },
            { id: 14, cat: "P_time", q: "이른 아침의 햇살과 늦은 밤의 달빛 중, 당신의 영혼이 더 깨어나는 시간은?", opts: ["새로운 시작의 활기가 느껴지는 이른 새벽", "모두가 잠든 뒤 깊은 사유가 가능한 늦은 밤"] },
            { id: 22, cat: "P_time", q: "갑작스러운 약속 취소로 생긴 자유시간, 당신의 첫 기분은?", opts: ["기다렸다는 듯 찾아온 혼자만의 여유가 반갑다", "함께하기로 했던 설렘이 사라져 조금 허전하다"] },
            { id: 27, cat: "P_time", q: "함께 있는 사람이 각자의 일에 몰두해 있다면, 당신은 어떻게 느끼나요?", opts: ["따로 또 같이 있는 평온한 신뢰를 느낀다", "함께 있음에도 느껴지는 거리감에 조금 외롭다"] },
            { id: 11, cat: "Shadow", q: "정해진 계획이 예기치 않게 바뀌었을 때, 당신의 내면은 어떻게 반응하나요?", opts: ["질서가 흐트러지는 것에 대해 미세한 불안을 느낀다", "바뀐 상황이 가져올 새로운 우연을 즐기려 한다"] },
            { id: 12, cat: "Shadow", q: "무리한 부탁을 거절해야 하는 순간, 당신의 마음을 채우는 생각은?", opts: ["상대를 실망시킬까 봐 걱정되는 미안함", "나의 한계를 지키려는 합리적인 판단"] },
            { id: 13, cat: "Shadow", q: "사람들에게 보여주고 싶은 당신의 모습은 주로 어느 쪽에 가까운가요?", opts: ["어떤 상황에서도 평정심을 잃지 않는 단단함", "주변을 환하게 만드는 밝고 다정한 에너지"] },
            { id: 18, cat: "Shadow", q: "당신만이 간직한 소중한 비밀은 당신에게 어떤 공간인가요?", opts: ["외부의 침범으로부터 나를 지켜주는 성역", "언젠가 진심을 다해 누군가와 나누고 싶은 선물"] },
            { id: 21, cat: "Shadow", q: "낯선 사람들과의 모임에서 당신은 주로 어떤 역할을 하시나요?", opts: ["흐름을 조용히 관찰하며 내면의 중심을 지킨다", "부드러운 분위기를 주도하며 대화를 이끌어간다"] },
            { id: 24, cat: "Shadow", q: "누군가 당신의 가치관을 비판한다면, 당신의 마음은 어디로 향하나요?", opts: ["스스로를 되짚어보며 깊은 생각에 잠기는 내면", "상대의 논리가 타당한지 분석해보는 외부"] },
            { id: 25, cat: "Shadow", q: "실수를 저질렀을 때, 당신을 가장 괴롭히는 마음은 무엇인가요?", opts: ["스스로에게 느끼는 실망감과 자책", "타인에게 끼친 영향에 대한 걱정"] },
            { id: 29, cat: "Shadow", q: "과거의 아쉬운 기억을 떠올릴 때, 당신은 보통 어떻게 대처하시나요?", opts: ["그때의 감정을 다시금 곱씹으며 의미를 찾는다", "지나간 일로 치부하며 현재에 집중하려 노력한다"] },
            { id: 17, cat: "S_root", q: "당신에게 '가장 나다워지는 순간'은 언제라고 느껴지나요?", opts: ["누구의 시선도 닿지 않는 혼자만의 온전한 자유", "내 진심을 알아주는 사람 곁에서 느끼는 편안함"] },
            { id: 20, cat: "S_root", q: "오랫동안 잊고 지낸 인연에게 연락이 온다면, 당신의 첫 마음은?", opts: ["반가움보다는 갑작스러운 변화에 조금 주춤하게 된다", "세월의 거리와 상관없이 반가운 마음이 먼저 앞선다"] },
            { id: 23, cat: "S_root", q: "소중한 사람과 의견이 어긋날 때, 당신이 가장 지키고 싶은 것은?", opts: ["서로의 다름을 인정하는 정직한 거리", "어떤 상황에서도 끊어지지 않는 정서적 연결"] },
            { id: 26, cat: "S_root", q: "당신이 생각하는 가장 이상적인 사랑의 형태는 무엇인가요?", opts: ["서로의 성장을 묵묵히 응원하는 든든한 동반자", "기쁨과 슬픔을 남김없이 공유하는 깊은 일체감"] },
            { id: 28, cat: "S_root", q: "당신이 꿈규는 완벽한 성취의 순간은 무엇과 닮아있나요?", opts: ["나만의 독보적인 가치를 세상에 당당히 증명하는 것", "사랑하는 이들과 평온한 일상을 평화롭게 지켜내는 것"] },
            { id: 30, cat: "S_root", q: "마지막으로, 당신의 마음을 여는 가장 소중한 열쇠는 무엇인가요?", opts: ["나의 서툰 결까지 있는 그대로 수용해 주는 이해", "어떤 폭풍우 속에서도 흔들리지 않는 깊은 헌신"] },
            { id: 100, cat: "S_root", q: "모든 분석이 끝났습니다. 이제 당신의 진심을 마주할 준비가 되셨나요?", opts: ["조금은 떨리지만 설레는 마음으로 확인한다", "차분하고 담담하게 결과를 받아들인다"] }
        ];

        let currentIdx = 0;
        let answers = {};
        const app = document.getElementById('app');

        function init() {
            const params = new URLSearchParams(window.location.search);
            const res = params.get('res');
            if (res) showReport(res);
            else renderMain();
        }

        function renderMain() {
            app.innerHTML = `
                <div class="fade-in">
                    <h1 style="letter-spacing: 0.5em; font-weight: 200; font-size: 38px;">SY-ON</h1>
                    <div id="formula" class="master-formula">$$M = \\oint_{t=0}^{24} \\left( \\frac{P_{time} \\times E_{env}}{\\sigma(Shadow)} \\right) \\cdot S_{root} \, dt$$</div>
                    <p style="font-size: 17px; font-weight: 300; margin-bottom: 50px; line-height: 1.6;">"우리는 사랑하기 위해,<br/>서로의 진심을 밝힙니다."</p>
                    <button class="btn-main" onclick="startQuiz()">분석 시작하기 (2분)</button>
                </div>
            `;
            refreshFormula();
        }

        function refreshFormula() {
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise();
            }
        }

        function startQuiz() {
            currentIdx = 0;
            renderQuiz();
        }

        function renderQuiz() {
            if (currentIdx === 15) { showBreak(); return; }
            const q = questions[currentIdx];
            document.getElementById('progress').style.width = (currentIdx / questions.length * 100) + '%';
            app.innerHTML = `
                <div class="fade-in" style="text-align: left;">
                    <div style="font-size: 10px; opacity: 0.3; letter-spacing: 2px; margin-bottom: 25px;">ANALYSIS ${currentIdx + 1} / 30</div>
                    <h2 style="font-weight: 300; line-height: 1.6; margin-bottom: 45px; font-size: 20px;">${q.q}</h2>
                    <div id="opts">
                        ${q.opts.map((opt, i) => `<button class="btn-option" onclick="handleSelect(${i})">${opt}</button>`).join('')}
                    </div>
                    ${currentIdx > 0 ? `<div class="back-link" onclick="goBack()">이전 단계로 돌아가기</div>` : ''}
                </div>
            `;
        }

        function handleSelect(val) {
            const btns = document.querySelectorAll('.btn-option');
            btns[val].classList.add('selected');
            if(window.navigator.vibrate) window.navigator.vibrate(25);
            
            setTimeout(() => {
                answers[questions[currentIdx].id] = val;
                currentIdx++;
                if (currentIdx < questions.length) renderQuiz();
                else showDone();
            }, 450);
        }

        function goBack() {
            currentIdx--;
            renderQuiz();
        }

        function showBreak() {
            app.innerHTML = `
                <div class="fade-in">
                    <h2 style="font-weight: 300; margin-bottom: 30px; font-size: 22px;">잠시 숨을 골라볼까요?</h2>
                    <p style="font-size: 14px; opacity: 0.7; line-height: 1.9; margin-bottom: 50px;">절반의 마음을 읽어냈습니다.<br/>조금 힘드시지는 않나요?<br/>다시 당신의 진심을 따라가 보겠습니다.</p>
                    <button class="btn-main" onclick="resumeQuiz()">다시 가기</button>
                </div>
            `;
        }

        function resumeQuiz() {
            currentIdx = 15;
            renderQuiz();
            // 15번에서 멈췄으니 다시 렌더링하면 16번째 질문(인덱스 15)이 나옴
        }

        function showDone() {
            document.getElementById('progress').style.width = '100%';
            app.innerHTML = `
                <div class="fade-in">
                    <h2 style="font-weight: 300; margin-bottom: 35px; font-size: 24px;">분석 완료</h2>
                    <p style="font-size: 14px; opacity: 0.7; line-height: 1.9; margin-bottom: 60px; padding: 0 15px;">931해 가지의 마음의 결을 모두 읽어냈습니다.<br/>상대방이 당신을 더 다정하게 안아줄 수 있도록<br/>이 결과를 전송해 주세요.</p>
                    <button id="sendBtn" class="btn-main" style="background: var(--amber); color: var(--indigo); font-weight: 700;" onclick="sendResult()">진심 전송하기</button>
                </div>
            `;
        }

        function sendResult() {
            const btn = document.getElementById('sendBtn');
            btn.classList.add('ghost-send');
            if(window.navigator.vibrate) window.navigator.vibrate([40, 80, 40]);
            
            setTimeout(() => {
                const resCode = btoa(JSON.stringify(answers));
                // 깃허브 경로 최적화 로직 적용 [cite: 2026-01-17]
                const baseUrl = window.location.href.split('?')[0];
                const finalUrl = baseUrl + '?res=' + resCode;
                
                navigator.clipboard.writeText(finalUrl).then(() => {
                    alert("마음의 결이 담긴 리포트 링크가 복사되었습니다. 상대방에게 카톡으로 전달해 주세요.");
                });
            }, 1000);
        }

        function showReport(raw) {
            try {
                const data = JSON.parse(atob(raw));
                let e = 0, s = 0;
                Object.keys(data).forEach(id => {
                    const q = questions.find(i => i.id == id);
                    if(q && q.cat === 'E_env') e += data[id];
                    if(q && q.cat === 'Shadow') s += data[id];
                });
                
                let triggers = ["왜 그래?", "갑자기", "예민해", "대충", "나중에 해", "그래서?", "피곤해"];
                let anchors = ["고요", "질서", "충분히", "천천히", "함께하자", "괜찮아", "그랬구나"];
                if (e > 4 && s > 4) {
                    triggers = ["왜 그래?", "갑자기", "예민해", "시끄러워", "정신없어", "대충대충", "그만해"];
                    anchors = ["고요", "질서", "충분히", "천천히", "기다려줄게", "평온함", "안정"];
                }

                app.innerHTML = `
                    <div class="fade-in">
                        <div style="font-size: 10px; opacity: 0.3; letter-spacing: 4px; margin-bottom: 40px; text-transform: uppercase;">Analysis Report</div>
                        <div class="report-card">
                            <p style="font-size: 10px; opacity: 0.4; letter-spacing: 2px; margin-bottom: 25px; uppercase">10대 금기어 (Triggers)</p>
                            <div>${triggers.map(tag => `<span class="tag" style="color: #FF8A8A; border-color: rgba(255,138,138,0.3)">${tag}</span>`).join('')}</div>
                            <div style="margin-top: 45px; border-top: 1px solid rgba(255,255,255,0.06); padding-top: 35px;">
                                <p style="font-size: 10px; opacity: 0.4; letter-spacing: 2px; margin-bottom: 25px; uppercase">10대 안식어 (Anchors)</p>
                                <div>${anchors.map(tag => `<span class="tag" style="color: #A8FFB2; border-color: rgba(168,255,178,0.3)">${tag}</span>`).join('')}</div>
                            </div>
                        </div>
                        <div class="back-link" onclick="window.location.search = ''">처음으로 돌아가기</div>
                    </div>
                `;
            } catch(err) { renderMain(); }
        }

        function showScience() {
            const overlay = document.getElementById('overlay');
            overlay.style.display = 'flex';
            overlay.innerHTML = `
                <div style="font-size: 11px; line-height: 2.1; opacity: 0.8;">
                    <div style="border-bottom: 1px solid rgba(255,211,105,0.2); padding-bottom: 18px; margin-bottom: 28px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="letter-spacing: 3px; font-weight: 500;">SY-ON METHODOLOGY</span>
                        <span style="cursor: pointer; font-size: 14px;" onclick="document.getElementById('overlay').style.display='none'">✕</span>
                    </div>
                    <p style="margin-bottom: 20px;"><strong>1. 신경계 자극 수용도 (E_env):</strong> 외부 환경의 물리적 자극(온도, 소음, 조명)에 대한 시상하부의 반응 임계치를 8개 문항을 통해 정밀 연산합니다.</p>
                    <p style="margin-bottom: 20px;"><strong>2. 서캐디언 정서 에너지 (P_time):</strong> 시간생물학 기반의 호르몬 주기와 정서적 회복탄력성 지표를 7개 문항의 시간축 데이터로 분석합니다.</p>
                    <p style="margin-bottom: 20px;"><strong>3. 분석심리학적 무의식 엔트로피 (σ_Shadow):</strong> 칼 융의 모델을 활용하여 사회적 가면과 무의식 사이의 마찰 계수를 공식의 분모값으로 산출합니다.</p>
                    <p style="margin-bottom: 20px;"><strong>4. 애착 항상성 모델 (S_root):</strong> 존 볼비의 애착 이론을 행렬 연산으로 변환하여 정서적 안전기지의 유지력을 가중치로 부여합니다.</p>
                    <p>본 시스템은 총 931해(Sextillion) 가지의 정서적 시나리오를 연산하며, 단일 질문이 아닌 복합 변수의 상호작용 결과를 통해 안식어와 금기어를 확정합니다.</p>
                </div>
            `;
        }

        init();
    </script>
</body>
</html>
