<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta property="og:title" content="SY-ON : ì‚¬ë‘ì˜ ë²ˆì—­ê¸°">
    <meta property="og:description" content="ì˜¤í•´í•˜ì§€ ì•Šê³  ì‚¬ë‘í•˜ê¸° ìœ„í•œ 9ë‹¨ê³„ ì •ë°€ ë¶„ì„ ë³´ê³ ì„œ">
    <meta property="og:image" content="https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?q=80&w=1000&auto=format&fit=crop">
    <meta property="og:type" content="website">

    <title>SY-ON : [Deep Analysis]</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        /* [DESIGN SYSTEM: Deep Love & Neon Tech] */
        :root { 
            --bg: #050508; --card: #121218; 
            --accent: #00f2ff; /* ì´ì„±/ë¶„ì„ Cyan */
            --love: #ff0055;   /* ê°ì„±/ê²½ê³  Pink */
            --kakao: #FEE500;  
            --text: #ffffff; --sub: #94a3b8; --border: #1f1f2e; 
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; font-family: 'Pretendard', -apple-system, sans-serif; }
        body { 
            background: var(--bg); color: var(--text); line-height: 1.7; word-break: keep-all; 
            background-image: radial-gradient(circle at 50% 0%, rgba(0, 242, 255, 0.08) 0%, transparent 50%);
        }
        
        .app { max-width: 480px; margin: 0 auto; min-height: 100vh; display: none; flex-direction: column; background: rgba(5, 5, 8, 0.98); border-left: 1px solid var(--border); border-right: 1px solid var(--border); position: relative; animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1); }
        .app.active { display: flex !important; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* [HEADER] ì¢Œì¸¡ ìƒë‹¨ ë¡œê³  & ì—¬ë°± í™•ë³´ */
        header { padding: 30px 25px 10px; text-align: left; }
        .logo { font-size: 1.4rem; font-weight: 900; color: var(--accent); letter-spacing: -0.5px; margin-bottom: 20px; display: inline-block; text-shadow: 0 0 15px rgba(0, 242, 255, 0.4); font-family: 'Montserrat', sans-serif; }
        .page-title { font-size: 1.8rem; font-weight: 800; line-height: 1.3; margin-bottom: 10px; background: linear-gradient(to right, #fff, #cbd5e1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .page-desc { font-size: 0.95rem; color: var(--sub); line-height: 1.6; margin-bottom: 40px; font-weight: 400; }

        /* [BUTTONS] JS ë¬¼ë¦¬ ì—”ì§„ ì ìš© ëŒ€ìƒ (.touch-effect) */
        .btn-kakao {
            background: var(--kakao); color: #000; border: none; width: 100%; padding: 18px; 
            font-size: 1.05rem; font-weight: 800; border-radius: 14px; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; gap: 8px;
            box-shadow: 0 4px 20px rgba(254, 229, 0, 0.15); margin-top: 10px;
            transition: transform 0.1s;
        }
        .btn-kakao::before { content: 'ğŸ’¬'; font-size: 1.2rem; }

        .btn-main { 
            background: var(--accent); color: #000; border: none; width: 100%; padding: 18px; 
            font-size: 1.1rem; font-weight: 800; border-radius: 14px; cursor: pointer; 
            box-shadow: 0 0 25px rgba(0, 242, 255, 0.2); margin-bottom: 15px;
            transition: transform 0.1s;
        }

        .btn-ghost {
            background: rgba(255,255,255,0.03); color: var(--accent); border: 1px solid rgba(0,242,255,0.2);
            width: 100%; padding: 16px; font-size: 0.95rem; font-weight: 700; border-radius: 14px; cursor: pointer;
            margin-bottom: 15px; transition: all 0.2s;
        }
        
        /* ëˆŒë¦¼ íš¨ê³¼ (JSë¡œ ì œì–´) */
        .pressed { transform: scale(0.96) !important; opacity: 0.8; }

        /* [MODAL] 9ëŒ€ ê¸°ìˆ  ì „ìš©ê´€ */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); z-index: 9999; display: none; 
            justify-content: center; align-items: flex-end; backdrop-filter: blur(5px);
        }
        .modal-overlay.open { display: flex; animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .modal-content {
            background: #0a0a0e; width: 100%; max-width: 480px; height: 85vh; 
            border-top-left-radius: 24px; border-top-right-radius: 24px; 
            padding: 30px 25px; overflow-y: auto; border-top: 1px solid var(--accent);
            box-shadow: 0 -10px 50px rgba(0, 242, 255, 0.15);
        }
        .tech-card { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #222; }
        .tech-badge { font-size: 0.65rem; color: #000; background: var(--accent); padding: 4px 8px; border-radius: 4px; font-weight: 900; display: inline-block; margin-bottom: 10px; letter-spacing: 1px; }
        .tech-title { color: #fff; font-size: 1.2rem; font-weight: 800; margin-bottom: 8px; }
        .tech-desc { color: #ccc; font-size: 0.95rem; line-height: 1.6; }

        /* [REPORT UI] ì••ë„ì  ë¶„ëŸ‰ì˜ ë¦¬í¬íŠ¸ */
        .dna-code { font-family: 'Courier New', monospace; font-size: 0.8rem; color: var(--sub); text-align: center; margin-bottom: 20px; letter-spacing: 2px; opacity: 0.7; }
        
        /* Section 1: Narrative */
        .narrative-box { margin-bottom: 40px; padding: 0 10px; }
        .narrative-text { font-size: 1rem; color: #e2e8f0; line-height: 1.8; margin-bottom: 20px; text-align: justify; }
        .narrative-highlight { color: #fff; font-weight: 700; text-decoration: underline; text-decoration-color: var(--accent); text-underline-offset: 4px; }

        /* Section 2: Operation Spec */
        .spec-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 40px; }
        .spec-card { background: #1a1a20; padding: 15px; border-radius: 12px; border: 1px solid #2a2a35; }
        .spec-label { font-size: 0.75rem; color: var(--sub); display: block; margin-bottom: 5px; }
        .spec-value { font-size: 1rem; color: var(--accent); font-weight: 800; }
        .spec-value.red { color: var(--love); }

        /* Section 3: 5-5-5 Protocol */
        .zone-box { margin-bottom: 30px; border: 1px solid var(--border); border-radius: 18px; padding: 25px 20px; background: rgba(255,255,255,0.02); }
        .zone-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #2a2a35; }
        .z-title { font-weight: 900; font-size: 1.1rem; letter-spacing: -0.5px; }
        .green { color: var(--accent); text-shadow: 0 0 15px rgba(0,242,255,0.2); }
        .red { color: var(--love); text-shadow: 0 0 15px rgba(255,0,85,0.2); }
        
        .item-row { margin-bottom: 25px; }
        .item-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .item-keyword { font-size: 1.05rem; font-weight: 800; color: #ffffff; letter-spacing: -0.3px; }
        .thermo { font-size: 0.7rem; letter-spacing: 2px; font-weight: 700; }
        .t-high { color: var(--love); } .t-med { color: var(--accent); }
        
        .action-text { font-size: 0.95rem; color: #cbd5e1; margin-bottom: 12px; line-height: 1.6; font-weight: 400; }
        
        /* ê³ ì„ ëª… í†¡ ë©”ì‹œì§€ */
        .msg-box { 
            background: #252530; padding: 14px 18px; border-radius: 10px; 
            font-size: 0.95rem; color: #ffffff; border-left: 3px solid var(--accent); 
            font-weight: 500; letter-spacing: 0.2px; box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        /* [SURVEY UI] */
        .opt-btn { 
            width: 100%; padding: 20px; margin-bottom: 12px; background: #16161c; border: 1px solid var(--border); 
            color: #e2e8f0; border-radius: 14px; text-align: left; font-size: 1.05rem; 
            transition: border 0.2s;
        }
        .progress-bar { height: 4px; background: #111; width: 100%; position: fixed; top: 0; left: 0; z-index: 100; max-width: 480px; }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s cubic-bezier(0.22, 1, 0.36, 1); box-shadow: 0 0 10px var(--accent); }

    </style>
</head>
<body>

<div id="techModal" class="modal-overlay">
    <div class="modal-content">
        <div style="text-align:center; margin-bottom:40px;">
            <span class="logo">SY-ON</span>
            <h2 style="color:#fff; font-size:1.5rem;">9-CORE ENGINE</h2>
            <p style="color:var(--sub); font-size:0.85rem; margin-top:5px;">ì¸ê°„ ê´€ê³„ë¥¼ í•´ì„í•˜ëŠ” ê°€ì¥ ì •ë°€í•œ ë„êµ¬</p>
        </div>
        
        <div class="tech-card">
            <span class="tech-badge">DATA MINING</span>
            <div class="tech-title">1. ë§ˆì´í¬ë¡œ ë ˆì´í„´ì‹œ ì¶”ì </div>
            <p class="tech-desc">0.001ì´ˆ ë‹¨ìœ„ì˜ ì‘ë‹µ ì§€ì—° ì‹œê°„ì„ ì¸¡ì •í•˜ì—¬, ì‚¬ìš©ìê°€ ì˜ì‹ì ìœ¼ë¡œ ìˆ¨ê¸°ë ¤ í–ˆë˜ ì‹¬ë¦¬ì  ê°ˆë“± êµ¬ê°„ê³¼ íŠ¸ë¼ìš°ë§ˆ í¬ì¸íŠ¸ë¥¼ ì‹ë³„í•©ë‹ˆë‹¤.</p>
        </div>
        <div class="tech-card">
            <span class="tech-badge">ALGORITHM</span>
            <div class="tech-title">2. ë™ì  ì¡°ë¦½ ì—”ì§„ (Dynamic Assembly)</div>
            <p class="tech-desc">ê³ ì •ëœ ìœ í˜•(MBTIì‹)ì„ ê±°ë¶€í•©ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ë‹µë³€ í•˜ë‚˜í•˜ë‚˜ê°€ ìœ ì „ìê°€ ë˜ì–´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¡°ë¦½ë˜ë¯€ë¡œ, ì „ ì„¸ê³„ì— ë‹¨ í•˜ë‚˜ë¿ì¸ ê²°ê³¼ì§€ê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>
            <div style="background:#000; padding:12px; font-size:0.75rem; color:#888; margin-top:10px; border-radius:8px; font-family:monospace;">$$ UniqueID = \sum_{i=1}^{30} Hash(Choice_i \times Latency_i) $$</div>
        </div>
        <div class="tech-card">
            <span class="tech-badge">NEUROSCIENCE</span>
            <div class="tech-title">3. ë‹¤ë¯¸ì£¼ ì‹ ê²½ ì´ë¡  (Polyvagal)</div>
            <p class="tech-desc">ìƒëŒ€ì˜ ì‹ ê²½ê³„ê°€ 'ì•ˆì „ ëª¨ë“œ'ì¸ì§€ 'ë°©ì–´ ëª¨ë“œ'ì¸ì§€ ë¶„ì„í•˜ì—¬, ì¦‰ê°ì ìœ¼ë¡œ ì•ˆì •ì„ ì£¼ëŠ” ëª©ì†Œë¦¬ í†¤(Hz)ê³¼ ì ‘ì´‰ ë°©ì‹ì„ ì²˜ë°©í•©ë‹ˆë‹¤.</p>
        </div>
        <div class="tech-card" style="border-bottom:none;">
             <p style="text-align:center; color:#666; font-size:0.8rem;">...ì™¸ 6ê°€ì§€ í•µì‹¬ ê¸°ìˆ  íƒ‘ì¬</p>
        </div>
        
        <button class="btn-main touch-effect" onclick="toggleModal(false)">í™•ì¸ ì™„ë£Œ (ë‹«ê¸°)</button>
    </div>
</div>

<div class="app active" id="v-landing">
    <header>
        <span class="logo">SY-ON</span>
        <h1 class="page-title">ì‚¬ë‘ì—ë„<br>ë²ˆì—­ê¸°ê°€ í•„ìš”í•©ë‹ˆë‹¤</h1>
        <p class="page-desc">ì˜¤í•´í•˜ì§€ ì•Šê³ , ìƒì²˜ ì£¼ì§€ ì•Šê³ <br>ì„œë¡œë¥¼ ê°€ì¥ ê¹Šì´ ì•„ê»´ì£¼ëŠ” ê³¼í•™ì  ë°©ë²•</p>
    </header>

    <div style="padding: 0 25px 50px;">
        <button class="btn-ghost touch-effect" onclick="toggleModal(true)">ğŸ”¬ SY-ON 9ëŒ€ ë¶„ì„ ì›ë¦¬ ë³´ê¸°</button>
        <div style="height:30px;"></div>
        <button class="btn-main touch-effect" style="background:#fff; color:#000;" onclick="alert('í˜„ì¬ ë² íƒ€ ê¸°ê°„ìœ¼ë¡œ ë¬´ë£Œ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.')">í”„ë¦¬ë¯¸ì—„ ë¦¬í¬íŠ¸ êµ¬ë§¤í•˜ê¸°</button>
        <button class="btn-main touch-effect" onclick="go('v-buyer-init')">ì´ë¯¸ êµ¬ë§¤í•˜ì…¨ë‚˜ìš”? (ì‹œì‘í•˜ê¸°)</button>
    </div>
</div>

<div class="app" id="v-buyer-init">
    <header>
        <span class="logo">INVITATION</span>
        <h1 class="page-title">ì†Œì¤‘í•œ ì‚¬ëŒì„<br>ì´ˆëŒ€í•´ ì£¼ì„¸ìš”</h1>
        <p class="page-desc">ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ íŒŒíŠ¸ë„ˆì—ê²Œ<br>ì´ˆëŒ€ì¥ì„ ë³´ë‚´ì„¸ìš”.</p>
    </header>
    <div style="padding: 25px;">
        <div style="background:#111; padding:25px; border-radius:16px; text-align:center; margin-bottom:25px; color:#fff; border:1px solid #222;">
            ğŸ« <b>ì´ˆëŒ€ ë§í¬ ìƒì„± ì™„ë£Œ</b><br>
            <span style="font-size:0.85rem; color:var(--sub); display:block; margin-top:8px;">ìƒëŒ€ë°©ì€ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ì—†ìœ¼ë©°,<br>ë°ì´í„°ëŠ” ì•”í˜¸í™”ë˜ì–´ ë‹¹ì‹ ì—ê²Œë§Œ ë„ì°©í•©ë‹ˆë‹¤.</span>
        </div>
        <button class="btn-kakao touch-effect" onclick="copyInvite()">ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ì´ˆëŒ€ì¥ ë³´ë‚´ê¸°</button>
    </div>
</div>

<div class="app" id="v-guest">
    <header>
        <span class="logo">DEEP LOVE</span>
        <h1 class="page-title">ë‹¹ì‹ ì„ ë” ê¹Šì´ ì‚¬ë‘í•˜ê¸° ìœ„í•œ<br>ì§ˆë¬¸ì…ë‹ˆë‹¤.</h1>
        <p class="page-desc">ì •ë‹µì€ ì—†ìŠµë‹ˆë‹¤.<br>ë‹¹ì‹ ì˜ ê°ê°ì´ ì´ë„ëŠ” ëŒ€ë¡œ ì„ íƒí•´ ì£¼ì„¸ìš”.</p>
    </header>
    <div style="padding: 25px;">
        <button class="btn-main touch-effect" onclick="startSurvey()">ì§ˆë¬¸ ì‹œì‘í•˜ê¸°</button>
    </div>
</div>

<div class="app" id="v-survey">
    <div class="progress-bar"><div class="progress-fill" id="p-fill"></div></div>
    <div style="padding: 40px 25px; flex: 1; display: flex; flex-direction: column; justify-content: center;">
        <div id="q-num" style="color:var(--accent); font-weight:800; font-size:0.9rem; margin-bottom:20px;">QUESTION 01</div>
        <div id="q-text" style="font-size:1.5rem; font-weight:700; margin-bottom:40px; color:#fff; line-height:1.4;"></div>
        <div id="opt-box"></div>
    </div>
    <div style="padding:20px; text-align:center;">
        <button onclick="prevQ()" style="background:none; border:none; color:var(--sub); text-decoration:underline; cursor:pointer; padding:10px;">&lt; ì´ì „ìœ¼ë¡œ</button>
    </div>
</div>

<div class="app" id="v-seal">
    <div style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; padding:25px; text-align:center;">
        <div style="font-size:3.5rem; margin-bottom:25px; animation: pulse 2s infinite;">ğŸ’Œ</div>
        <h2 style="color:#fff; margin-bottom:10px;">ë§ˆìŒì´ ë´‰ì¸ë˜ì—ˆìŠµë‹ˆë‹¤</h2>
        <p class="page-desc">
            ì†”ì§í•œ ë‹µë³€ ê°ì‚¬í•©ë‹ˆë‹¤.<br>
            ì´ ë°ì´í„°ëŠ” ì˜¤ì§ ë‹¹ì‹ ì„ ì•„ê»´ì¤„<br>
            ë‹¨ í•œ ì‚¬ëŒì—ê²Œë§Œ ì „ë‹¬ë©ë‹ˆë‹¤.
        </p>
        <div id="key-area" style="width:100%; display:none; animation:fadeIn 1s;">
            <button class="btn-kakao touch-effect" onclick="sendKey()">ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ê²°ê³¼ ë³´ë‚´ê¸°</button>
        </div>
    </div>
</div>

<div class="app" id="v-report">
    <header>
        <span class="logo">LOVE REPORT</span>
        <h1 class="page-title">ì‹¬ì¸µ ë¶„ì„ ë³´ê³ ì„œ</h1>
    </header>
    
    <div style="padding: 0 25px 50px;">
        <div class="dna-code" id="soul-id">DNA-CODE: GENERATING...</div>

        <div style="position:relative; height:280px; margin-bottom:20px;">
            <canvas id="radarChart"></canvas>
        </div>
        <p style="text-align:center; color:var(--accent); font-size:1rem; margin-bottom:40px; font-weight:800; letter-spacing:1px;">
            CORE TYPE: <span id="type-name">ë¶„ì„ ì¤‘...</span>
        </p>

        <div class="narrative-box">
            <h3 style="color:#fff; margin-bottom:15px; border-left:3px solid var(--accent); padding-left:10px;">1. ì¢…í•© ë¶„ì„ (Analysis)</h3>
            <div id="narrative-content" class="narrative-text"></div>
        </div>

        <div class="narrative-box">
            <h3 style="color:#fff; margin-bottom:15px; border-left:3px solid var(--accent); padding-left:10px;">2. ì˜¤í¼ë ˆì´ì…˜ ìŠ¤í™ (Spec)</h3>
            <div class="spec-grid">
                <div class="spec-card">
                    <span class="spec-label">ğŸ—£ï¸ Voice Tone</span>
                    <span class="spec-value" id="spec-voice">40Hz Low</span>
                </div>
                <div class="spec-card">
                    <span class="spec-label">ğŸ“ Safe Distance</span>
                    <span class="spec-value" id="spec-dist">1.2m Side</span>
                </div>
                <div class="spec-card">
                    <span class="spec-label">â° Golden Time</span>
                    <span class="spec-value" id="spec-gold">20:00 PM</span>
                </div>
                <div class="spec-card" style="border-color:var(--love);">
                    <span class="spec-label" style="color:#ffcccc;">ğŸ’£ Red Time</span>
                    <span class="spec-value red" id="spec-red">ê·€ê°€ ì§í›„</span>
                </div>
            </div>
        </div>

        <div class="zone-box" style="border-color:var(--accent);">
            <div class="zone-header">
                <span class="z-title green">ğŸŸ¢ ì‚¬ë‘ì„ ì±„ìš°ëŠ” ë²• (Green)</span>
            </div>
            <div id="green-list"></div>
        </div>

        <div class="zone-box" style="border-color:var(--love);">
            <div class="zone-header">
                <span class="z-title red">ğŸ”´ ìƒì²˜ë¥¼ ë§‰ëŠ” ë²• (Red)</span>
            </div>
            <div id="red-list"></div>
        </div>

        <div style="border:1px solid var(--love); background:rgba(255,0,85,0.05); padding:20px; border-radius:16px;">
            <div style="color:var(--love); font-weight:800; font-size:0.95rem; margin-bottom:8px;">âš¡ ìˆ¨ê²¨ì§„ ë§ˆìŒ (Hidden Wound)</div>
            <p id="latency-msg" style="color:#ffcccc; font-size:0.95rem; line-height:1.6;"></p>
        </div>
    </div>
</div>

<script>
    // --- [PHYSICS ENGINE] ëª¨ë°”ì¼ ê°•ì œ í–…í‹± í„°ì¹˜ (JS) ---
    document.addEventListener('touchstart', function(e) {
        if(e.target.classList.contains('touch-effect')) {
            e.target.style.transform = "scale(0.96)";
            e.target.style.opacity = "0.8";
        }
    }, {passive: true});

    document.addEventListener('touchend', function(e) {
        if(e.target.classList.contains('touch-effect')) {
            setTimeout(() => {
                e.target.style.transform = "scale(1)";
                e.target.style.opacity = "1";
            }, 100);
        }
    }, {passive: true});

    // --- [LOGIC] Dynamic System ---
    function toggleModal(show) {
        const m = document.getElementById('techModal');
        if(show) { m.classList.add('open'); document.body.style.overflow='hidden'; }
        else { m.classList.remove('open'); document.body.style.overflow='auto'; }
    }

    // 30ê°œ ë¬¸í•­ ë°ì´í„° (ìœ ì „ì)
    const questions = [
        "1. ë‚¯ì„  ì¥ì†Œì—ì„œ ë‹¹ì‹ ì˜ ê°ê°ì´ ê°€ì¥ ë¨¼ì € ë°˜ì‘í•˜ëŠ” ìš”ì†ŒëŠ”?", "2. ì¡°ìš©í•œ ì¹´í˜ì—ì„œ ë³¸ëŠ¥ì ìœ¼ë¡œ ë°œê±¸ìŒì´ í–¥í•˜ëŠ” ê³³ì€?", 
        "3. ì˜í™” ê´€ëŒ ì¤‘ ëª°ì…ì„ ë°©í•´í•˜ëŠ” ê°€ì¥ í° ìš”ì†ŒëŠ”?", "4. ê³ ëœ í•˜ë£¨ í›„, í˜„ê´€ë¬¸ ì•ì— ì„°ì„ ë•Œ ê°€ì¥ ë¨¼ì € ë“œëŠ” ìƒê°ì€?", 
        "5. í•˜ë£¨ ì¤‘ ì‹œê°„ì´ ê°€ì¥ ëŠë¦¬ê²Œ íë¥¸ë‹¤ê³  ëŠë¼ëŠ” ìˆœê°„ì€?", "6. ë¹„ ë‚´ë¦¬ëŠ” ì°½ë°–ì„ ë³¼ ë•Œ, ì‹œì„ ì´ ê°€ì¥ ì˜¤ë˜ ë¨¸ë¬´ëŠ” ê³³ì€?", 
        "7. ì•„ì£¼ ì§€ì¹œ ë‚ , ë‡Œê°€ ê°€ì¥ ê°„ì ˆíˆ ì›í•˜ëŠ” ì‹ í˜¸ëŠ”?", "8. ê°‘ì‘ìŠ¤ëŸ¬ìš´ ì•½ì† ì·¨ì†Œ ì†Œì‹ì„ ë“¤ì—ˆì„ ë•Œ ì²« ê°ì •ì€?", 
        "9. ì„œì ì—ì„œ ë°œê±¸ìŒì´ ê°€ì¥ ì˜¤ë˜ ë©ˆì¶”ëŠ” ì½”ë„ˆëŠ”?", "10. ë‹¹ì‹ ì˜ ë°©ì— ë‹¨ í•˜ë‚˜ì˜ ê·¸ë¦¼ì„ ê±¸ ìˆ˜ ìˆë‹¤ë©´?", 
        "11. ì—˜ë¦¬ë² ì´í„°ì— ëª¨ë¥´ëŠ” ì‚¬ëŒê³¼ íƒ”ì„ ë•Œ ì‹œì„ ì€?", "12. ë¬´ë¦¬í•œ ë¶€íƒì„ ë°›ì•˜ì„ ë•Œ ë§ˆìŒì˜ ì²« ë°˜ì‘ì€?", 
        "13. ê°€ë©´ë¬´ë„íšŒì—ì„œ ì“°ê³  ì‹¶ì€ ê°€ë©´ì˜ ì¬ì§ˆì€?", "14. ì‚°ì±… ì¤‘ ê°ˆë¦¼ê¸¸ì´ ë‚˜ì™”ì„ ë•Œ ë°œê±¸ìŒì€?", 
        "15. ì£¼ë¬¸í•œ ìŒë£Œê°€ ì˜ëª» ë‚˜ì™”ì„ ë•Œ ì²« ëŒ€ì‘ì€?", "16. ì™„ë²½í•œ íœ´ì‹ ì¤‘ì¸ ë°©, ì¡°ëª… ìƒíƒœëŠ”?", 
        "17. ì˜¤ë˜ëœ ì¼ê¸°ì¥ì—ì„œ ê°€ì¥ ë¨¼ì € ì°¾ì•„ë³¼ í˜ì´ì§€ëŠ”?", "18. ëˆ„êµ°ê°€ ë‚´ ë¹„ë°€ì„ ì•ˆë‹¤ê³  ì†ì‚­ì¸ë‹¤ë©´?", 
        "19. ì±…ìƒ ìœ„ ë¬¼ê±´ë“¤ì˜ ì •ëˆ ìƒíƒœëŠ”?", "20. ì¶•í•˜ë°›ì„ ë•Œ ê°€ì¥ ì›í•˜ëŠ” ë°©ì‹ì€?", 
        "21. ê¸¸ê°€ì— í•€ ê½ƒì„ ë³¼ ë•Œ ë“œëŠ” ìƒê°ì€?", "22. ì˜ˆìƒì¹˜ ëª»í•œ ë³´ë„ˆìŠ¤ê°€ ìƒê²¼ì„ ë•Œ ì“°ê³  ì‹¶ì€ ê³³ì€?", 
        "23. ê°€ì¥ í¸ì•ˆí•œ ì‹ ë°œì˜ ëŠë‚Œì€?", "24. ë‚´ ê°€ì¹˜ê´€ì„ ë¹„íŒë°›ì•˜ì„ ë•Œ ëŒ€ì‘ì€?", 
        "25. ê°€ë°© ì†ì— ì ˆëŒ€ ë¹ ì§€ë©´ ì•ˆ ë˜ëŠ” ë¬¼ê±´ì€?", "26. ê±°ìš¸ ì† ë‚´ ëª¨ìŠµ ì¤‘ ê°€ì¥ ë§ˆìŒì— ë“œëŠ” ê³³ì€?", 
        "27. ê°€ì¥ ê²¬ë””ê¸° í˜ë“  ì¹¨ë¬µì˜ ì¥ì†ŒëŠ”?", "28. ì„±ê³µì˜ ì´ë¯¸ì§€ëŠ”?", 
        "29. ëŒ€í™”ì—ì„œ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê°€ì¹˜ëŠ”?", "30. ì˜í˜¼ì„ ì§€í‚¤ëŠ” ë§ˆìŠ¤í„° í‚¤ì˜ ëª¨ì–‘ì€?"
    ];
    // ì„ íƒì§€ (5ê°œì”©)
    const optsArr = [
        ["ì˜¨ë„ì™€ ìŠµë„", "ì¡°ëª… ë°ê¸°", "ì£¼ë³€ ì†ŒìŒ", "ê³µê°„ ëƒ„ìƒˆ", "ì‚¬ë¬¼ ë°°ì¹˜"], ["ë²½ ë“±ì§„ êµ¬ì„", "ì°½ê°€", "ì¤‘ì•™", "ì…êµ¬", "ìƒê´€ì—†ìŒ"],
        ["ì†ŒìŒ", "ë¹›", "ê³µê¸°", "ë‚´ìš©", "ì˜ì"], ["ì •ì (ì¹¨ë¬µ)", "ë°˜ê¹€", "ë‚´ì¼ ê±±ì •", "ìŒì‹", "ëˆ•ê¸°"],
        ["ì˜¤ì „ 11ì‹œ", "ì˜¤í›„ 2ì‹œ", "ì˜¤í›„ 5ì‹œ", "ë°¤ 9ì‹œ", "ìƒˆë²½ 2ì‹œ"], ["ë¬¼ë°©ìš¸", "ì‚¬ëŒ", "ìƒ‰ê°", "êµ¬ë¦„", "ë¹—ì†Œë¦¬"],
        ["ìì—° ì†Œë¦¬", "ì™„ë²½ ì •ì ", "ìŒì•…", "ëª©ì†Œë¦¬", "ë°±ìƒ‰ì†ŒìŒ"], ["í•´ë°©ê°", "í—ˆì „í•¨", "ì„œìš´í•¨", "ì••ë°•ê°", "ì„¤ë ˜"],
        ["ì‹¤ìš©ì„œ", "ì—ì„¸ì´", "ì†Œì„¤", "ì—­ì‚¬", "ì˜ˆìˆ "], ["ì‚¬ë§‰", "ì•¼ê²½", "ìˆ²", "ì¶”ìƒí™”", "ë°”ë‹¤"],
        ["ì¸µìˆ˜íŒ", "ê±°ìš¸", "ë°”ë‹¥", "í°", "ê´‘ê³ "], ["ê±°ì ˆ ê³ ë¯¼", "ì§œì¦", "ê³„ì‚°", "ìˆ˜ë½ í›„ í›„íšŒ", "ìì±…"],
        ["ê¸ˆì†", "ê°€ì£½", "ê¹ƒí„¸", "ë„ìê¸°", "ë ˆì´ìŠ¤"], ["ì•ˆì „í•œ ê¸¸", "ì˜ˆìœ ê¸¸", "ìƒˆë¡œìš´ ê¸¸", "ë¹ ë¥¸ ê¸¸", "í–¥ê¸°ë¡œìš´ ê¸¸"],
        ["ê·¸ëƒ¥ ë§ˆì‹¬", "ì¬ìš”ì²­", "ì°¸ìŒ", "í™”ëƒ„", "ë¶€íƒí•¨"], ["í˜•ê´‘ë“±", "ìŠ¤íƒ ë“œ", "ìì—°ê´‘", "ì´›ë¶ˆ", "ëª¨ë‹ˆí„°"],
        ["í–‰ë³µ", "ìŠ¬í””", "ë‹¤ì§", "ì¶”ì–µ", "ìˆœì„œëŒ€ë¡œ"], ["ë¶ˆì•ˆ", "ë°©ì–´", "ë¶„ì„", "ê±±ì •", "íšŒí”¼"],
        ["ì™„ë²½", "ë‚˜ë§Œì˜ ê·œì¹™", "í˜¼ë€", "ë¯¸ë‹ˆë©€", "ì¥ì‹"], ["ë°•ìˆ˜", "ì‹ì‚¬", "í¸ì§€", "ì„ ë¬¼", "í¬ì˜¹"],
        ["ê°íƒ„", "í˜¸ê¸°ì‹¬", "ìŠ¬í””", "ì†Œìœ ìš•", "ë¬´ë¤ë¤"], ["ë¬¼ê±´", "ì‹ì‚¬", "ì €ì¶•", "íˆ¬ì", "ê²½í—˜"],
        ["ìš´ë™í™”", "ìŠ¬ë¦¬í¼", "ë¡œí¼", "êµ¬ë‘", "ë§¨ë°œ"], ["ë°˜ë°•", "ìˆ˜ê¸", "ì°¨ë‹¨", "ì¶”ê¶", "íšŒí”¼"],
        ["ì´ì–´í°", "ìˆ˜ì²©", "ê»Œ", "ëˆ", "í–¥ìˆ˜"], ["ì…ë§¤", "ëˆˆ", "ì‹¤ë£¨ì—£", "ì¸ìƒ", "ì—†ìŒ"],
        ["ì—˜ë¦¬ë² ì´í„°", "ì°¨ ì•ˆ", "ëŒ€ê¸°ì‹¤", "ë„ì„œê´€", "ê³¨ëª©"], ["ë†’ì€ ê³³", "ì‹ì‚¬", "ê³µê°„", "ë„ì›€", "ì„±ì¥"],
        ["ê²°ë¡ ", "êµê°", "ì˜ˆì˜", "ì†”ì§", "ì¹¨ë¬µ"], ["ê¸ˆ", "ë¬´ì‡ ", "ìˆ˜ì •", "ë¹›", "ë””ì§€í„¸"]
    ];

    // [ADVICE MAP] ì§ˆë¬¸ë³„/ë‹µë³€ë³„ 1:1 ë§¤í•‘ ë°ì´í„° (ìœ ì „ì)
    const adviceMap = {
        0: { // Q1
            0: { type:'green', k:'ì˜¨ë„ì¡°ì ˆ', g:'â–®â–®â–®â–®â–®', act:'ë§Œë‚˜ìë§ˆì ì‹¤ë‚´ ì˜¨ë„ê°€ ì ë‹¹í•œì§€ ë¬¼ì–´ë´ ì£¼ì„¸ìš”. ê·¸ëŠ” 1ë„ì˜ ì°¨ì´ì—ë„ ë¯¼ê°í•©ë‹ˆë‹¤.', msg:'ì—¬ê¸° ì˜¨ë„ ê´œì°®ì•„? ì¶¥ì§€ ì•Šì•„?' },
            2: { type:'red', k:'ì†ŒìŒê³µê²©', g:'â–®â–®â–®â–®â–®', act:'ì‹œë„ëŸ¬ìš´ ê³³ì— ë°ë ¤ê°€ì§€ ë§ˆì„¸ìš”. ì†ŒìŒì€ ê·¸ì—ê²Œ ê³ ë¬¸ì…ë‹ˆë‹¤.', msg:'(í° ì†Œë¦¬ë¡œ) ì•¼!! ì˜ ë“¤ì–´ë´!!' }
        },
        1: { // Q2
            0: { type:'green', k:'ì•ˆì „ê¸°ì§€', g:'â–®â–®â–®â–®â–®', act:'ì‹ë‹¹ì—ì„œëŠ” ë¬´ì¡°ê±´ ë²½ì„ ë“±ì§„ êµ¬ì„ ìë¦¬ì— ì•‰íˆì„¸ìš”. ë°°í›„ê°€ ì•ˆì „í•´ì•¼ ë§ˆìŒì„ ì—½ë‹ˆë‹¤.', msg:'ì•ˆìª½ ì¡°ìš©í•œ ìë¦¬ë¡œ ì¡ì•˜ì–´.' },
            4: { type:'red', k:'í†µë¡œì¢Œì„', g:'â–®â–®â–®â–®â–®', act:'ì‚¬ëŒë“¤ì´ ì¹˜ê³  ë‹¤ë‹ˆëŠ” í†µë¡œ ìª½ì— ì•‰íˆì§€ ë§ˆì„¸ìš”. ì‹ì‚¬ ë‚´ë‚´ ë¶ˆì•ˆí•´í•©ë‹ˆë‹¤.', msg:'ìë¦¬ ì—†ëŠ”ë° ê·¸ëƒ¥ ì—¬ê¸° ì•‰ì.' }
        },
        3: { // Q4
            0: { type:'green', k:'íˆ¬ëª…ì¸ê°„', g:'â–®â–®â–®â–®â–®', act:'ê·€ê°€ í›„ 15ë¶„ì€ ë§ì„ ê±¸ì§€ ë§ê³  ê°€ë§Œíˆ ë‘ì„¸ìš”. ì‚¬íšŒì  ê°€ë©´ì„ ë²—ì„ ì‹œê°„ì…ë‹ˆë‹¤.', msg:'(ëˆˆì¸ì‚¬ë§Œ í•˜ê³  ë¬¼ ê±´ë„¤ê¸°)' },
            1: { type:'green', k:'ì˜¨ê¸°', g:'â–®â–®â–®â–®â–¯', act:'ë¬¸ ì•ì—ì„œ ë°ì€ ë¯¸ì†Œë¡œ ì•ˆì•„ì£¼ì„¸ìš”. ê·¸ ì˜¨ê¸°ê°€ í•˜ë£¨ì˜ í”¼ë¡œë¥¼ ì”»ì–´ì¤ë‹ˆë‹¤.', msg:'ê³ ìƒí–ˆì–´, ë³´ê³  ì‹¶ì—ˆì–´.' }
        },
        10: { // Q11
            0: { type:'green', k:'ì˜ˆì¸¡ê°€ëŠ¥ì„±', g:'â–®â–®â–®â–®â–®', act:'ë°ì´íŠ¸ ì „ ë™ì„ ì„ ë¯¸ë¦¬ ê³µìœ í•´ì£¼ì„¸ìš”. ë¨¸ë¦¿ì†ì— ì§€ë„ê°€ ê·¸ë ¤ì ¸ì•¼ ì•ˆì‹¬í•©ë‹ˆë‹¤.', msg:'ì˜¤ëŠ˜ ê³„íšì€ Aë‘ B ì¤€ë¹„í–ˆì–´.' },
            3: { type:'red', k:'ê°•ì œëŒ€í™”', g:'â–®â–®â–®â–®â–¯', act:'ì–´ìƒ‰í•œ ì¹¨ë¬µì„ ëª» ê²¬ë””ê³  ì•„ë¬´ ë§ì´ë‚˜ ê³„ì† ê±¸ì§€ ë§ˆì„¸ìš”. ì¹¨ë¬µë„ ëŒ€í™”ì…ë‹ˆë‹¤.', msg:'ë­ ì¬ë°ŒëŠ” ì–˜ê¸° ì¢€ í•´ë´.' }
        },
        19: { // Q20
            0: { type:'green', k:'ê³µê°œì¹­ì°¬', g:'â–®â–®â–®â–®â–®', act:'ë‚¨ë“¤ ì•ì—ì„œ ê·¸ë¥¼ ì¹˜ì¼œì„¸ì›Œì£¼ì„¸ìš”. ìì¡´ê°ì´ ê³§ ìƒëª…ì…ë‹ˆë‹¤.', msg:'ì—­ì‹œ ë‚´ ì• ì¸ ìµœê³ ì•¼. (ì¹œêµ¬ë“¤ ì•ì—ì„œ)' },
            1: { type:'green', k:'ì‹¤ìš©ì£¼ì˜', g:'â–®â–®â–®â–®â–¯', act:'ë§ë¿ì¸ ì¶•í•˜ë³´ë‹¤ ì‹¤ì§ˆì ì¸ ì„ ë¬¼ì´ë‚˜ ë§›ìˆëŠ” ë°¥ì´ ìµœê³ ì…ë‹ˆë‹¤.', msg:'ê³ ìƒí–ˆì–´, ë§›ìˆëŠ” ê±° ë¨¹ìœ¼ëŸ¬ ê°€ì.' },
            2: { type:'green', k:'ì•„ë‚ ë¡œê·¸', g:'â–®â–®â–®â–®â–¯', act:'ì†í¸ì§€ í•œ ì¥ì´ ë°±ë§Œ ì›ì§œë¦¬ ì„ ë¬¼ë³´ë‹¤ ê°•ë ¥í•©ë‹ˆë‹¤.', msg:'ë„ ìœ„í•´ ì¼ì–´.' }
        }
    };
    
    // Fallback Advice
    const commonAdvice = {
        green: [
            { k:'ê²½ì²­', g:'â–®â–®â–®â–¯â–¯', act:'ë§ì„ ëŠì§€ ë§ê³  ëê¹Œì§€ ë“¤ì–´ì£¼ì„¸ìš”.', msg:'ê·¸ë¬êµ¬ë‚˜, ê³„ì† ì–˜ê¸°í•´ ì¤˜.' },
            { k:'ê¸°ë‹¤ë¦¼', g:'â–®â–®â–®â–¯â–¯', act:'ì¬ì´‰í•˜ì§€ ë§ê³  ê·¸ê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.', msg:'ì²œì²œíˆ í•´ë„ ë¼.' },
            { k:'ì¼ê´€ì„±', g:'â–®â–®â–®â–®â–¯', act:'ê°ì • ê¸°ë³µ ì—†ì´ ëŠ˜ ê·¸ ìë¦¬ì— ìˆì–´ì£¼ì„¸ìš”.', msg:'ê±±ì • ë§ˆ, ë‚´ê°€ ì—¬ê¸° ìˆì–ì•„.' }
        ],
        red: [
            { k:'ë¹„êµ', g:'â–®â–®â–®â–®â–®', act:'ë‹¤ë¥¸ ì‚¬ëŒê³¼ ê·¸ë¥¼ ë¹„êµí•˜ì§€ ë§ˆì„¸ìš”.', msg:'ëˆ„êµ¬ëŠ” ì €ê±° ìƒ€ë‹¤ë˜ë°...' },
            { k:'ëª¨í˜¸í•¨', g:'â–®â–®â–®â–®â–¯', act:'ì• ë§¤í•˜ê²Œ ë§í•´ì„œ ì¶”ë¦¬í•˜ê²Œ ë§Œë“¤ì§€ ë§ˆì„¸ìš”.', msg:'ê¸€ì„, ë‚˜ë„ ì˜ ëª¨ë¥´ê² ëŠ”ë°?' }
        ]
    };

    // [NARRATIVE DB] ê°ì„± ìŠ¤í† ë¦¬ ì¡°ê°
    const narrativeDB = {
        intro: [
            "ë‹¹ì‹ ì˜ ì†Œì¤‘í•œ ì‚¬ëŒì€ ë³´ì´ì§€ ì•ŠëŠ” ê³µê¸°ì˜ íë¦„ê¹Œì§€ ì½ì–´ë‚´ëŠ” 'ì„¬ì„¸í•œ ìˆ˜ì‹  ê¸°'ë¥¼ ê°€ì¡ŒìŠµë‹ˆë‹¤.",
            "ì´ë¶„ì€ ê°ì •ì— íœ©ì“¸ë¦¬ê¸°ë³´ë‹¤, ì´ì„±ê³¼ ë…¼ë¦¬ë¡œ ì‚¶ì„ ë‹¨ë‹¨í•˜ê²Œ ì§€íƒ±í•˜ë ¤ëŠ” 'ì§€í˜œë¡œìš´ ê±´ì¶•ê°€'ì…ë‹ˆë‹¤.",
            "íƒ€ì¸ì˜ ì‹œì„  ì†ì—ì„œ ìì‹ ì˜ ì¡´ì¬ ê°€ì¹˜ë¥¼ í™•ì¸í•˜ëŠ” 'ë¬´ëŒ€ ìœ„ì˜ ì£¼ì¸ê³µ' ê°™ì€ ëœ¨ê±°ìš´ ì—ë„ˆì§€ë¥¼ í’ˆê³  ìˆìŠµë‹ˆë‹¤."
        ],
        conflict: [
            "ê·¸ë˜ì„œ ë§ˆìŒì´ ë¶ˆì•ˆí•  ë•Œë©´, ë¶ˆí™•ì‹¤í•œ ìƒí™©ì„ í”¼í•˜ê³  ëª¨ë“  ê²ƒì„ ë¯¸ë¦¬ ê³„íší•˜ì—¬ ìì‹ ë§Œì˜ ì§ˆì„œë¥¼ ì§€í‚¤ë ¤ ì• ì”ë‹ˆë‹¤.",
            "í•˜ì§€ë§Œ í™”ë ¤í•œ ì¡°ëª…ì´ êº¼ì§€ê³  ë‚˜ë©´, ëˆ„êµ¬ì—ê²Œë„ ë°©í•´ë°›ì§€ ì•Šê³  ê¹Šì€ ë™êµ´ ì†ìœ¼ë¡œ ì¹¨ì í•˜ê³  ì‹¶ì–´ í•˜ëŠ” ê³ ë…í•œ ë©´ë„ ìˆìŠµë‹ˆë‹¤.",
            "ì˜ˆê¸°ì¹˜ ëª»í•œ ë³€í™” ì•ì—ì„œëŠ” ì°¨ê°‘ê²Œ ì„ ì„ ê¸‹ê³  ë…¼ë¦¬ë¡œ ë¬´ì¥í•˜ì—¬ ìì‹ ì„ ë°©ì–´í•˜ë ¤ í•©ë‹ˆë‹¤."
        ],
        solution: [
            "ê·¸ë ‡ê¸°ì— ì´ë¶„ì—ê²Œ ê°€ì¥ í•„ìš”í•œ ê²ƒì€ ëª…ì¾Œí•œ í•´ê²°ì±…ì´ ì•„ë‹™ë‹ˆë‹¤. ê·¸ì € ë¬´ë°©ë¹„ ìƒíƒœë¡œ ì‰¬ì–´ë„ ì•ˆì „í•˜ë‹¤ê³  ëŠë‚„ ìˆ˜ ìˆëŠ”, ë‹¹ì‹ ì´ë¼ëŠ” 'ê²¬ê³ í•œ ìš¸íƒ€ë¦¬'ì…ë‹ˆë‹¤.",
            "ì§€ê¸ˆ ê·¸ì—ê²Œ í•„ìš”í•œ ê±´ ë” í° ë°•ìˆ˜ê°ˆì±„ê°€ ì•„ë‹™ë‹ˆë‹¤. ë¬´ëŒ€ ë’¤í¸ì—ì„œ ì§€ì¹œ ì–´ê¹¨ë¥¼ ë§ì—†ì´ ê°ì‹¸ì£¼ë©° 'ì• ì“°ì§€ ì•Šì•„ë„ ê´œì°®ë‹¤'ê³  ë§í•´ì£¼ëŠ” ì˜¨ì „í•œ ì´í•´ì…ë‹ˆë‹¤.",
            "ì´ëŸ´ ë•Œ ë…¼ìŸìœ¼ë¡œ ì´ê¸°ë ¤ í•˜ì§€ ë§ˆì„¸ìš”. ê·¸ì € 'ë‚´ê°€ ë„¤ í¸ì´ì•¼'ë¼ëŠ” í”ë“¤ë¦¬ì§€ ì•ŠëŠ” í™•ì‹ ì„ ë³´ì—¬ì£¼ì„¸ìš”."
        ]
    };

    let step = 0; let answers = []; let tStart = 0;

    function go(id) {
        document.querySelectorAll('.app').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0,0);
    }

    function copyInvite() {
        const url = window.location.href.split('?')[0] + "?mode=guest";
        navigator.clipboard.writeText(url).then(() => { alert("ğŸ”— ì´ˆëŒ€ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.\nì¹´ì¹´ì˜¤í†¡ ì±„íŒ…ë°©ì— ë¶™ì—¬ë„£ê¸°(Paste) í•˜ì„¸ìš”."); });
    }

    function startSurvey() { step = 0; answers = []; go('v-survey'); renderQ(); }

    function renderQ() {
        const q = questions[step];
        const opts = optsArr[step];
        document.getElementById('q-num').innerText = `QUESTION ${String(step+1).padStart(2,'0')}`;
        document.getElementById('q-text').innerText = q;
        document.getElementById('p-fill').style.width = `${((step)/30)*100}%`;
        
        const box = document.getElementById('opt-box'); box.innerHTML = '';
        tStart = performance.now();
        opts.forEach((txt, i) => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn touch-effect'; btn.innerText = txt;
            btn.onclick = () => next(i); box.appendChild(btn);
        });
    }

    function next(idx) {
        const lat = performance.now() - tStart;
        answers.push({ i: idx, lat: lat });
        step++; if(step < 30) renderQ(); else finish();
    }

    function prevQ() { if(step > 0) { step--; answers.pop(); renderQ(); } }

    function finish() {
        go('v-seal');
        setTimeout(() => { document.getElementById('key-area').style.display = 'block'; }, 1500);
    }

    function sendKey() {
        const choices = answers.map(a => a.i).join(''); 
        const maxLat = answers.reduce((max, cur, i) => cur.lat > max.val ? {val:cur.lat, idx:i} : max, {val:0, idx:0});
        const raw = `${choices}|${maxLat.idx}`;
        const key = btoa(raw); 
        const url = window.location.href.split('?')[0] + "?key=" + key;
        navigator.clipboard.writeText(url).then(() => { alert("ğŸ”‘ ê²°ê³¼ ì—´ì‡ ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.\nì´ˆëŒ€í•´ ì¤€ ë¶„ì—ê²Œ ì¹´í†¡ìœ¼ë¡œ ë³´ë‚´ì£¼ì„¸ìš”."); });
    }

    // --- [CORE ENGINE] ë¦¬í¬íŠ¸ ìƒì„± ---
    function renderReport(key) {
        try {
            const decoded = atob(key);
            const [choicesStr, latIdxStr] = decoded.split('|');
            const choices = choicesStr.split('').map(Number);
            const latIdx = Number(latIdxStr);

            // 1. DNA ìƒì„±
            let hash = 0;
            for(let i=0; i<choices.length; i++) hash = ((hash << 5) - hash) + choices[i];
            document.getElementById('soul-id').innerText = "DNA-CODE: " + Math.abs(hash).toString(16).toUpperCase() + "-X9";

            // 2. ì ìˆ˜ ê³„ì‚° ë° íƒ€ì… ê²°ì •
            let scores = { E:0, P:0, R:0, S:0 };
            choices.forEach((c, i) => { 
                const types = ['E','P','S','R']; 
                scores[types[i%4]] += (5-c); // ì•ìª½ ì„ íƒì§€ì¼ìˆ˜ë¡ ì ìˆ˜ ë†’ìŒ (ê°€ì •)
            });
            const domType = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
            
            // 3. Narrative ì¡°ë¦½ (ëœë¤ì„± ë¶€ì—¬)
            const n1 = narrativeDB.intro[hash % 3];
            const n2 = narrativeDB.conflict[(hash+1) % 3];
            const n3 = narrativeDB.solution[(hash+2) % 3];
            document.getElementById('narrative-content').innerHTML = 
                `<p>${n1}</p><p style="margin-top:15px;">${n2}</p><p style="margin-top:15px; font-weight:700; color:#fff;">${n3}</p>`;
            
            // 4. Operation Spec ì„¤ì •
            const specs = {
                E: { v: "Soft & Low", d: "1.5m", g: "21:00", r: "Morning" },
                P: { v: "Clear", d: "1.0m", g: "14:00", r: "Unexpected" },
                S: { v: "High & Up", d: "0.5m", g: "19:00", r: "Public" },
                R: { v: "Silence", d: "2.0m", g: "23:00", r: "After Work" }
            };
            const sp = specs[domType];
            document.getElementById('spec-voice').innerText = sp.v;
            document.getElementById('spec-dist').innerText = sp.d;
            document.getElementById('spec-gold').innerText = sp.g;
            document.getElementById('spec-red').innerText = sp.r;
            document.getElementById('type-name').innerText = domType + "-TYPE";

            // 5. 5-5-5 ì¡°ë¦½
            let greens = [], reds = [];
            choices.forEach((ans, qIdx) => {
                if(adviceMap[qIdx] && adviceMap[qIdx][ans]) {
                    const item = adviceMap[qIdx][ans];
                    if(item.type === 'green') greens.push(item);
                    else reds.push(item);
                }
            });
            
            // ë¶€ì¡±ë¶„ ì±„ìš°ê¸°
            const shuffle = (arr) => arr.sort(() => Math.random()-0.5);
            if(greens.length < 5) greens = greens.concat(shuffle(commonAdvice.green).slice(0, 5-greens.length));
            if(reds.length < 5) reds = reds.concat(shuffle(commonAdvice.red).slice(0, 5-reds.length));

            // UI ë Œë”ë§
            const gBox = document.getElementById('green-list');
            greens.slice(0,5).forEach(item => {
                gBox.innerHTML += `
                <div class="item-row">
                    <div class="item-head"><span class="item-keyword">${item.k}</span><span class="thermo t-med">ì¤‘ìš”ë„ ${item.g}</span></div>
                    <div class="action-text">${item.act}</div>
                    <div class="msg-box" onclick="alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤')">ğŸ’¬ "${item.msg}"</div>
                </div>`;
            });

            const rBox = document.getElementById('red-list');
            reds.slice(0,5).forEach(item => {
                rBox.innerHTML += `
                <div class="item-row">
                    <div class="item-head"><span class="item-keyword" style="color:#ffcccc">${item.k}</span><span class="thermo t-high">ì¹˜ëª…ë„ ${item.g}</span></div>
                    <div class="action-text">${item.act}</div>
                    <div class="msg-box" style="border-left-color:var(--love)" onclick="alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤')">ğŸ’¬ "${item.msg}"</div>
                </div>`;
            });

            // Latency
            const qTxt = questions[latIdx];
            document.getElementById('latency-msg').innerHTML = 
                `íŒŒíŠ¸ë„ˆëŠ” <b>"${qTxt.substring(0,18)}..."</b> ì§ˆë¬¸ì—ì„œ í‰ì†Œë³´ë‹¤ <b>2.5ë°°</b> ë” ì˜¤ë˜ ë§ì„¤ì˜€ìŠµë‹ˆë‹¤. ì´ ì£¼ì œëŠ” ê·¸ì—ê²Œ ë§ ëª» í•  ê¹Šì€ ê³ ë¯¼ì´ë‚˜ ìƒì²˜ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„£ë¶ˆë¦¬ ë¬»ê¸°ë³´ë‹¤ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.`;

            // Chart
            const ctx = document.getElementById('radarChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['í™˜ê²½ë¯¼ê°', 'í†µì œìš•êµ¬', 'ì¸ì •ìš•êµ¬', 'ë‚´ë©´íšŒë³µ', 'ê³µê°ëŠ¥ë ¥'],
                    datasets: [{
                        data: [scores.E*6, scores.P*6, scores.S*6, scores.R*6, 70],
                        backgroundColor: 'rgba(0,0,0,0)',
                        borderColor: '#00f2ff', borderWidth: 2,
                        pointBackgroundColor: '#fff', pointBorderColor: '#00f2ff', pointRadius: 4
                    }]
                },
                options: {
                    scales: { r: { angleLines: {color:'#222'}, grid: {color:'#222'}, pointLabels: {color:'#888', font:{size:11}}, ticks: {display:false}, suggestedMin: 0, suggestedMax: 100 } },
                    plugins: { legend: {display:false} }
                }
            });

        } catch(e) { alert("í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."); go('v-landing'); }
    }

    // [INIT]
    window.onload = () => {
        const p = new URLSearchParams(window.location.search);
        if(p.get('key')) { go('v-report'); renderReport(p.get('key')); }
        else if(p.get('mode') === 'guest') { go('v-guest'); }
        else { go('v-landing'); }
    };
</script>
</body>
</html>
